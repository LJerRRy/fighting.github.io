---
layout: post
title: 日期中“周日历”的格式化
date: 2020-11-12 23:47:01
catalog:    true
author: "Jerry"
header-img: "img/post-bg-os-metro.jpg"
tags: 
    - Java
---


## 日期中“周日历”的格式化

### 背景

最近项目需要统计业务数据，可以按照日、周、月、年维度进行统计，筛选出特定时间范围内的数据，数据需要按照日期进行分页。由于开发时间有限且表中数据并不是很多，一年新增1w条左右，表的增删改操作不是很频繁，所以直接对原表查询，按照`日、周、月、年`维度统计。


其中按照`日、月、年`维度比较好统计，直接要统计时间字段进行分组，如下

```mysql
select count(*), sum(amt), date_format('%y', biz_date) from group by date_format(biz_date, '%Y')
```

针对不同统计维度替换时间格式化的字符串即可：

1. 年：'%Y'
2. 月：'%Y-%m'
3. 日： '%Y-%m-%d'

但是针对周维度统计，可能第一时间想到`date_format(biz_date, '%Y-%v')`，这么写会有一个问题，比如日期`2019-12-30`格式化的周数是有问题的，执行下面SQL：

```mysql
select date_format('2019-12-30', '%Y-%v');
# 执行结果：2019-01
```

可能你会困惑，这里不应该是2019年最后一周即2019-53，其实这里格式化'%v'的结果为01，是因为2019年最后一周其实算作2020年的第一周，即`2020-01`。如果将格式化字符串改成`'%x-%v'`，即可得出正确结果，SQL如下：

```mysql
select date_format('2019-12-30', '%x-%v');
# 执行结果：2020-01
```

mysql中

1. `%v`: 以周一开始的年周数，两位数字
2. `%V`: 以周日开始的年周数，两位数字
3. `%x`: 年数，要和`%v`使用，表示以周一开始的年数
4. `%X`: 年数，要和`%V`使用，表示以周日开始的年数

### ISO周数年

很多小伙伴可能会困惑，`2019-12-30`日期怎么格式化后算作2020年第一周，这个就是今天来介绍的`ISO周数年`.

我们知道一年有365天，闰年有366天，那么一年有52个或者53个星期。ISO周的年编号规定，**每个星期从周一开始**，每年第一个星期包含当年的第一个星期四（并且总是包含1月4号），ISO周的年编号因此会稍微偏离1月1日几天。

例如： 2020年第一周就从2019年12月30号周一开始算，而2016年的第一周从1月四号开始，1月1号-3号都算作2015年最后一周


ISO周日历还有一些性质这里就不一样介绍了，可以点[周日历](http://wanweibaike.com/wiki-ISO%E9%80%B1%E6%97%A5%E6%9B%86)查看


### java中如何去格式化周数年(LocalDate)

java8中新增了一些日期操作的公共类，诸如`java.time.LocalDateTime` `java.time.LocalDate` `java.time.Period`等时间操作类，整个`java.time`包下都是新增的。今天我们来一起看看如何用`LocalDate`去操作日期。

`LocalDate`类是去除时区的ISO-8601日历系统的日期，就是该类中不包含时区的信息，例如2020-11-13，通常用来生日之类和时区无关的日期。